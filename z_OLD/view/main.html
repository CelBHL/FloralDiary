<!DOCTYPE html>
<html>

<head>
    <title>Floral Diary</title>
</head>

<style>
    body {
        background-image: url("http://www.thirumuraifestivallondon2014.com/wp-content/uploads/2014/06/flower-background-designs-free-download.jpg");
        background-attachment: fixed;
        background-repeat: no-repeat;
        background-size: cover;
    }
    
    .container {
        margin: auto;
        text-align: center;
    }
    
    span {
        display: inline-block;
        width: 70px;
        text-align: left;
    }
    
    input {
        display: inline-block;
    }
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<body>

    <div class="container">
        <!-------------------------- Register Form -------------------------->
        <h3>User Registration</h3>
        <span>Username:</span>
        <input type='text' id='name' placeholder='username' /> <br/>
        <span>Password:</span>
        <input type='password' id='pass' placeholder='password' /> <br/>
        <span>Address:</span>
        <input type='text' id='add' placeholder='address' /> <br/>
        <span>Phone:</span>
        <input type='text' id='phone' placeholder='phone' /> <br/>
        <span>Email:</span>
        <input type='text' id='email' placeholder='email' /> <br/>
        <button id='reg'>Register</button>

        <br/>
        <br/>

        <!-------------------------- Login Form -------------------------->
        <h3>User Login</h3>
        <span>Username:</span>
        <input type='text' id='username' placeholder='username' /> <br/>
        <span>Password:</span>
        <input type='password' id='password' placeholder='password' /> <br/>
        <button id='sub'>Login</button>

        <br/>
        <br/>

        <!-------------------------- Update Form -------------------------->
        <h3>User Profile Update</h3>
        <span>Username:</span>
        <input type='text' id='udname' placeholder='username' /> <br/>
        <span>Password:</span>
        <input type='password' id='udpass' placeholder='password' /> <br/>
        <span>Address:</span>
        <input type='text' id='udadd' placeholder='address' /> <br/>
        <span>Phone:</span>
        <input type='text' id='udphone' placeholder='phone' /> <br/>
        <span>Email:</span>
        <input type='text' id='udemail' placeholder='email' /> <br/>
        <button id='save'>Save</button>


        <!-------------------------- ITEM NAME -------------------------->
        <h1>Items</h1>

        <div id="insertitems" style="display:none">
            <strong>Update Item Name</strong>
            <div id="update"></div>
            <button id="update_itemname">UPDATE NAME</button>
            <br/><br/>

            <strong>Insert Item Info</strong>
            <br/>
            <input id="itemname" type="text" placeholder="Item name" />
            <input id="itemdes" type="text" placeholder="Item description" />
            <input id="itemprice" type="text" placeholder="Item price" />
            <button id="submititem">Store</button>
            <br/><br/>
        </div>


        <strong>View Items</strong>
        <div id="all_users"></div>

    </div>
</body>

<script>
    $(document).ready(function() {
        var user_id = -1;


        document.getElementById("reg").onclick = function() {

            $.ajax({
                url: "../cont/user.php",
                type: "post",
                dataType: "html",
                data: {
                    method: "insert",
                    name: document.getElementById("name").value,
                    password: document.getElementById("pass").value,
                    address: document.getElementById("add").value,
                    phone: document.getElementById("phone").value,
                    email: document.getElementById("email").value,
                },
                success: function(resp) {
                    console.log(resp);
                }
            });
        };


        //modify our files a little bit later
        document.getElementById("sub").onclick = function() {
            //connect and insert
            $.ajax({
                url: "../cont/username_c.php",
                type: "post",
                dataType: "json",
                data: {
                    method: "login",
                    username: document.getElementById("username").value,
                    password: document.getElementById("password").value
                },
                success: function(resp) {
                    alert(resp[0].id);
                    alert(resp[0].name);
                    console.log(resp);
                    user_id = resp[0].id;
                    username = resp[0].name;
                    document.getElementById("insertitems").style.display = "block";

                    for (var i = 0; i < resp.length; i++) {
                        var unameInp = document.getElementById("udname");
                        var passInp = document.getElementById("udpass");
                        var addInp = document.getElementById("udadd");
                        var phoneInp = document.getElementById("udphone");
                        var emailInp = document.getElementById("udemail");


                        unameInp.value = resp[i].name;
                        passInp.value = resp[i].password;
                        addInp.value = resp[i].address;
                        phoneInp.value = resp[i].phone;
                        emailInp.value = resp[i].email;
                    }

                    document.getElementById("save").onclick = function() {

                        $.ajax({
                            url: "../cont/user.php",
                            dataType: "json",
                            data: {
                                method: "updateUser",
                                id: user_id,
                                name: document.getElementById("udname").value,
                                password: document.getElementById("udpass").value,
                                address: document.getElementById("udadd").value,
                                phone: document.getElementById("udphone").value,
                                email: document.getElementById("udemail").value,
                            },
                            type: "POST",
                            success: function(resp) {
                                alert("UPDATED!!");
                            }
                        }); //ajax close
                    }
                }
            });
        }


        ///////////////////////  ITEM NAME   ////////////////////////////
        //INSERTING ITEM NAME

        document.getElementById("submititem").onclick = function() {
            var itemname = document.getElementById("itemname").value;
            var itemdes = document.getElementById("itemdes").value;
            var itemprice = document.getElementById("itemprice").value;


            $.ajax({
                url: "../cont/items_c.php",
                dataType: "html",
                data: {
                    method: "insert",
                    user_id: user_id,
                    username: username,
                    itemname: itemname,
                    itemdes: itemdes,
                    itemprice: itemprice
                },
                type: "POST",
                success: function(resp) {
                    alert("YES");
                    // location.reload();
                }
            });
        }


        /////////////////////////////////////////////////////////////////////////////////////////////////

        //VIEWING ITEMS
        $.ajax({
            url: "../cont/items_c.php",
            dataType: "json",
            data: {
                method: "view",
            },

            type: "POST",
            success: function(resp) {
                    console.log(resp);

                    for (var i = 0; i < resp.length; i++) {
                        var pass_div = document.createElement("div");
                        //var breaky = document.createElement("br");
                        var namespan = document.createElement("h4");
                        var desspan = document.createElement("h4");
                        var pricespan = document.createElement("h4");
                        var username = document.createElement("h4");

                        pass_div.style.border = '4px solid black';
                        pass_div.style.width = '550px';
                        pass_div.style.margin = 'auto';
                        username.innerHTML = resp[i].username;
                        namespan.innerHTML = resp[i].name;
                        desspan.innerHTML = resp[i].description;
                        pricespan.innerHTML = resp[i].price;
                        document.getElementById("all_users").appendChild(pass_div);
                        pass_div.appendChild(username);
                        pass_div.appendChild(namespan);
                        pass_div.appendChild(desspan);
                        pass_div.appendChild(pricespan);

                        //HTML5 DATA!! we put the database id into the div
                        //pass_div.dataset.id = resp[i].id;
                        namespan.dataset.id = resp[i].id;
                        desspan.dataset.id = resp[i].id;
                        pricespan.dataset.id = resp[i].id;


                        ////////////////////UPDATE ITEM INFO ONCLICK

                        desspan.onclick = function() {

                            var pass_input = document.createElement("input");
                            pass_input.id = "itemdes";
                            pass_input.value = this.innerHTML;
                            document.getElementById("update").innerHTML = "";
                            document.getElementById("update").appendChild(pass_input);
                            document.getElementById("update_itemname").dataset.passid = this.dataset.id;

                            editDiv = this;

                        }


                        ////////////////////DELETE!!!!
                        var pass_del = document.createElement("button");
                        pass_del.dataset.id = resp[i].id;
                        pass_del.innerHTML = "Delete";
                        document.getElementById("all_users").appendChild(pass_del);
                        pass_del.onclick = function() {
                            var pass_id = this.dataset.id;

                            $.ajax({
                                url: "../cont/items_c.php",
                                dataType: "json",
                                type: "POST",
                                data: {
                                    method: "delete",
                                    id: pass_id
                                },
                                success: function(resp) {
                                    alert("DELETED!");
                                    location.reload();
                                    //editDiv.parentNode.removeChild(editDiv);
                                    //this.parentNode.removeChild(this);
                                }
                            });
                        }
                    }

                } //success close
        });

        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //UPDATE ITEM NAME
        document.getElementById("update_itemname").onclick = function() {

                var cur_button = this;
                var item_id = this.dataset.passid;
                $.ajax({
                    url: "../cont/items_c.php",
                    dataType: "json",
                    data: {
                        method: "update",
                        id: item_id,
                        itemname: document.getElementById("itemname").value,
                        itemdes: document.getElementById("itemdes").value,
                        itemprice: document.getElementById("itemprice").value
                    },
                    type: "POST",
                    success: function(resp) {
                        alert("UPDATED!!");
                        //		editDiv.innerHTML = document.getElementById("itemname").value
                        editDiv.innerHTML = document.getElementById("itemdes").value
                            //      editDiv.innerHTML = document.getElementById("itemprice").value
                    }
                }); //ajax close
            } //update_but onclick close



        //};
    }); //script function close
</script>

</html>